<div id="resume">

  <div *ngIf="loading" class="container">
    <div class="loading" [nbSpinner]="loading" nbSpinnerStatus="primary" nbSpinnerMessage="Loading Document...">
    </div>
  </div>

  <div *ngIf="submitted" class="container submitted">
    <div class="card">
      <div class="card-body">
        <div class="topic">
          <mat-icon>check_circle_outline</mat-icon>
          <p>{{ 'SUBMIT_SUCCESS' | translate }}</p>
          <br>
          <div>{{ 'SUBMIT_CONTENT' | translate }}</div>
          <div>{{ 'SUBMIT_THANK' | translate }}</div>
        </div>
        <button *ngIf="!detailFlag" mat-flat-button type="button" color="primary" (click)="gotoStatus()">
          {{ 'BACK_HOME' | translate }}
        </button>
        <!-- <button mat-flat-button type="button" color="primary" (click)="closeWindow()">
          {{ 'CLOSE' | translate }}
        </button> -->
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !submitted">

    <div class="nav-bar" [style.background]="template.bgColor">
      <div class="nav-brand">
        <mat-icon>account_box</mat-icon>
        <div class="title" [style.color]="template.titleColor">{{ template.title }}</div>
        <div class="sub-title" [style.color]="template.subTitleColor">{{ template.subTitle }}</div>
      </div>
      <div class="nav-right">
        <span class="lang" [ngClass]="{ 'active' : language === 'en' }" [style.color]="template.titleColor"
          (click)="setLang('en')">ENG</span>
        |
        <span class="lang" [ngClass]="{ 'active' : language === 'th' }" [style.color]="template.titleColor"
          (click)="setLang('th')">ไทย</span>
      </div>
    </div>
    <form id="headerForm" class="container" (ngSubmit)="save()" style="padding-top: 2rem;">
      <nb-stepper #stepper disableStepNavigation="true" [(selectedIndex)]="selectIndex">

        <!-- --------------------------------------------------------------- -->
        <!-- STEP 1 -->
        <nb-step>

          <!-- JR -->
          <!-- <div class="card" *ngIf="jrs.length && !template.jobPositions.length"> -->
          <div class="card" *ngIf="jrs.length">
            <div class="card-body">
              <div class="row">
                <div *ngIf="detailFlag" class="col-md-12" style="text-align: right;">
                  <span (click)="setEdit()" class="btn-link">
                    <nb-icon class="font-inherit m-r-5" *ngIf="!editFlag" icon="eye-outline">
                    </nb-icon>
                    <nb-icon class="font-inherit m-r-5" *ngIf="editFlag" icon="edit-2-outline">
                    </nb-icon>
                    {{ buttonText.toUpperCase() }}
                  </span><br>
                </div>
              </div>
              <div class="topic">
                <mat-icon>notifications_active</mat-icon>
                <p>{{ 'JOB_OPENINGS' | translate }} <span class="text-red">*</span></p>
              </div>
              <div class="row">
                <div class="offset-lg-2 col-lg-8">
                  <!-- (selectionChange)="onChangeJR($event.value)" -->
                  <!-- <mat-form-field appearance="outline" class="fit-content">
                    <mat-label>{{ 'POSITION' | translate }}</mat-label>
                    <mat-select [(ngModel)]="appForm.refJR" [ngModelOptions]="{standalone: true}" required
                      [disabled]="isDisabled || isDisableJob">
               
                      <mat-option *ngFor="let option of jrs" [value]="option.value">
                        {{ option.label }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field> -->
                  <div *ngIf="!recruiterAll">
                    <div *ngFor="let option of jrs">
                      <nb-checkbox [(ngModel)]="option.checked" [ngModelOptions]="{standalone: true}"
                        (checkedChange)="onSelectPosition($event, option)" status="primary"
                        [disabled]="isDisabled || isDisableJob">
                        {{ option.refJD.position }}
                      </nb-checkbox>
                    </div>
                  </div>
                  <div *ngIf="recruiterAll">
                    <div *ngFor="let option of jrs">
                      <nb-checkbox [(ngModel)]="option.checked" [ngModelOptions]="{standalone: true}"
                        (checkedChange)="onSelectPosition($event, option)" status="primary" [disabled]="!editFlag">
                        {{ option.refJD.position }}
                      </nb-checkbox>
                    </div>
                  </div>
                  <div class="title" *ngIf="template.jobRemark && this.appForm.refJR"
                    [style.color]="template.jobRemarkColor">{{ template.jobRemark }}</div>
                </div>
              </div>

              <!-- Hubs -->
              <div *ngIf="appForm.refJR && hubs.length" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <!-- <div *ngIf="hub.provinces.length" class="text-gray">{{ 'PROVINCE' | translate }}</div> -->
                  <div class="text-gray">HUB</div>
                  <div *ngFor="let hub of hubs">
                    <!-- recruiter -->
                    <div *ngIf="recruiterAll">
                      <nb-checkbox [(ngModel)]="hub.checked" [ngModelOptions]="{standalone: true}"
                        (checkedChange)="onChangeHub($event, hub._id)" status="primary" [disabled]="!editFlag">
                        {{ language === 'en' ? hub.name.en :hub.name.th }}
                      </nb-checkbox>
                      <div *ngIf="hub.checked && hub.provinces.length > 0" style="margin-left: 1.5rem;">
                        <div *ngFor="let province of hub.provinces">
                          <nb-checkbox [(ngModel)]="province.checked" [ngModelOptions]="{standalone: true}"
                            (checkedChange)="onChangeProvince($event, province.refProvince)" status="primary"
                            [disabled]="!editFlag">
                            <span *ngIf="editFlag"
                              [ngClass]="{ 'text-red': province.color, 'text-black': !province.color  }">
                              {{ language === 'en' ? province.name.en :province.name.th }}
                            </span>
                            <span *ngIf="!editFlag">
                              {{ language === 'en' ? province.name.en :province.name.th }}
                            </span>
                          </nb-checkbox>
                          <div *ngIf="province.checked" style="margin-left: 1.75rem;">
                            <div *ngFor="let area of province.areas">
                              <nb-checkbox [(ngModel)]="area.checked" [ngModelOptions]="{standalone: true}"
                                (checkedChange)="onChangeArea($event, area._id)" status="primary"
                                [disabled]="!editFlag">
                                <span *ngIf="editFlag"
                                  [ngClass]="{ 'text-red': area.color, 'text-black': !area.color }">
                                  {{ area.name }}
                                </span>
                                <span *ngIf="!editFlag">
                                  {{ area.name }}
                                </span>
                                <span *ngIf="!area.isDeleted">
                                  <span *ngIf="area.isFull" class="text-red">
                                    {{ language === 'en' ? '(Full)' :'(เต็ม)' }}</span>
                                  <span class="text-red" *ngIf="!area.isFull && area.remark">
                                    ({{ area.remark }})</span>
                                </span>
                                <span *ngIf="area.isDeleted" class="text-red">
                                  *** DELETED ***
                                </span>
                              </nb-checkbox>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="!recruiterAll">
                      <nb-checkbox [(ngModel)]="hub.checked" [ngModelOptions]="{standalone: true}"
                        (checkedChange)="onChangeHub($event, hub._id)" status="primary"
                        [disabled]="(isDisabled || successFlag) && !editFlag">
                        {{ language === 'en' ? hub.name.en :hub.name.th }}
                      </nb-checkbox>
                      <div *ngIf="hub.checked && hub.provinces.length > 0" style="margin-left: 1.5rem;">
                        <div *ngFor="let province of hub.provinces">
                          <nb-checkbox [(ngModel)]="province.checked" [ngModelOptions]="{standalone: true}"
                            (checkedChange)="onChangeProvince($event, province.refProvince)" status="primary"
                            [disabled]="(isDisabled || successFlag) && !editFlag">
                            <span *ngIf="editFlag"
                              [ngClass]="{ 'text-red': province.color, 'text-black': !province.color  }">
                              {{ language === 'en' ? province.name.en :province.name.th }}
                            </span>
                            <span *ngIf="!editFlag">
                              {{ language === 'en' ? province.name.en :province.name.th }}
                            </span>
                          </nb-checkbox>
                          <div *ngIf="province.checked" style="margin-left: 1.75rem;">
                            <div *ngFor="let area of province.areas">
                              <nb-checkbox [(ngModel)]="area.checked" [ngModelOptions]="{standalone: true}"
                                (checkedChange)="onChangeArea($event, area._id)" status="primary"
                                [disabled]="(isDisabled || successFlag) && !editFlag">
                                <span *ngIf="editFlag"
                                  [ngClass]="{ 'text-red': area.color, 'text-black': !area.color }">
                                  {{ area.name }}
                                </span>
                                <span *ngIf="!editFlag">
                                  {{ area.name }}
                                </span>
                                &nbsp;&nbsp;&nbsp;
                                <span *ngIf="!area.isDeleted">
                                  <span *ngIf="area.isFull" class="text-red">
                                    {{ language === 'en' ? '(Full)' :'(เต็ม)' }}</span>
                                  <span class="text-red" *ngIf="!area.isFull && area.remark">
                                    ({{ area.remark }})</span>
                                </span>
                                <span *ngIf="area.isDeleted" class="text-red">
                                  *** DELETED ***
                                </span>
                              </nb-checkbox>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- <div *ngFor="let province of hub.provinces">
                    <mat-checkbox [(ngModel)]="province.checked" [ngModelOptions]="{standalone: true}"
                      (click)="onChangeProvince()" [disabled]="isDisabled">
                      {{ language === 'en' ? province.refProvince.name.en :province.refProvince.name.th }}
                    </mat-checkbox>

                    <div *ngIf="province.checked" style="margin-left: 1.5rem;">
                      <div *ngIf="province.districts.length" class="m-t-5 text-gray">{{ 'DISTRICT' | translate }}</div>
                      <div *ngFor="let district of province.districts">
                        <mat-checkbox [(ngModel)]="district.checked" [ngModelOptions]="{standalone: true}"
                          (click)="onChangeDistrict()" [disabled]="isDisabled">
                          {{ language === 'en' ? district.refDistrict.name.en :district.refDistrict.name.th }}
                        </mat-checkbox>

                        <div *ngIf="district.checked" style="margin-left: 1.5rem;">
                          <div *ngIf="district.subDistricts.length" class="m-t-5 text-gray">
                            {{ 'SUB_DISTRICT' | translate }}</div>
                          <div *ngFor="let subDistrict of district.subDistricts">
                            <mat-checkbox [(ngModel)]="subDistrict.checked" [ngModelOptions]="{standalone: true}"
                              [disabled]="isDisabled">
                              {{ language === 'en' ? subDistrict.refSubDistrict.name.en : subDistrict.refSubDistrict.name.th }}
                            </mat-checkbox>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> -->
                </div>
              </div>
            </div>
          </div>
          <div class="footer-right">
            <button *ngIf="template.isExpress" nbButton type="button" status="primary"
              (click)="validJob(refCompany, undefined, refPosition)" [disabled]="!appForm.refJR">
              {{ 'NEXT' | translate }}
            </button>
            <button *ngIf="!template.isExpress" nbButton type="button" nbStepperNext [disabled]="!appForm.refJR">
              {{ 'NEXT' | translate }}
            </button>
          </div>
        </nb-step>

        <!-- --------------------------------------------------------------- -->
        <!-- STEP 2 -->
        <nb-step>

          <!-- Personal Details -->
          <div class="card" *ngIf="template.personalDetail.active">
            <div class="card-body">
              <div class="row">
                <div *ngIf="detailFlag" class="col-md-12" style="text-align: right;">
                  <span (click)="setEdit()" class="btn-link">
                    <nb-icon class="font-inherit m-r-5" *ngIf="!editFlag" icon="eye-outline">
                    </nb-icon>
                    <nb-icon class="font-inherit m-r-5" *ngIf="editFlag" icon="edit-2-outline">
                    </nb-icon>
                    {{ buttonText.toUpperCase() }}
                  </span><br>
                </div>
              </div>
              <div class="topic">
                <mat-icon>account_circle</mat-icon>
                <p>{{ 'PERSONAL_DETAILS' | translate }}</p>
              </div>
              <div class="row">
                <div class="col-md-2" *ngIf="template.personalDetail.firstname.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'TITLE_NAME' | translate }}</mat-label>
                    <mat-select [(ngModel)]="appForm.title" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                      <!-- <mat-option value="นาย">นาย</mat-option>
                      <mat-option value="นาง">นาง</mat-option>
                      <mat-option value="นางสาว">นางสาว</mat-option> -->
                      <mat-option *ngFor="let title of titleListTH" [value]="title.value">
                        {{ title.label }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-md-5" *ngIf="template.personalDetail.firstname.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'FIRST_NAME' | translate }} ({{ 'THAI' | translate }})</mat-label>
                    <input matInput type="text" id="firstname" name="firstname" [(ngModel)]="appForm.firstname"
                      [required]="template.personalDetail.firstname.required" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                  </mat-form-field>
                </div>
                <div class="col-md-5" *ngIf="template.personalDetail.lastname.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'LAST_NAME' | translate }} ({{ 'THAI' | translate }})</mat-label>
                    <input matInput type="text" id="lastname" name="lastname" [(ngModel)]="appForm.lastname"
                      [required]="template.personalDetail.lastname.required" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-md-2" *ngIf="template.personalDetail.firstnameEN.visible">
                  <!-- <mat-form-field appearance="outline">
                    <mat-label>{{ 'GENDER' | translate }}</mat-label>
                    <mat-select [(ngModel)]="appForm.gender" [ngModelOptions]="{standalone: true}"
                      [disabled]="isDisabled">
                      <mat-option value="Male">
                        {{ 'MALE' | translate }}
                      </mat-option>
                      <mat-option value="Female">
                        {{ 'FEMALE' | translate }}
                      </mat-option>
                      <mat-option value="Not specified">
                        {{ 'NOT_SPECIFY' | translate }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field> -->
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'TITLE_NAME' | translate }}</mat-label>
                    <mat-select [(ngModel)]="appForm.title" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                      <!-- <mat-option value="Mr.">Mr.</mat-option>
                      <mat-option value="Mrs.">Mrs.</mat-option>
                      <mat-option value="Miss">Miss</mat-option> -->
                      <mat-option *ngFor="let title of titleListEN" [value]="title.value">
                        {{ title.label }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-md-5" *ngIf="template.personalDetail.firstnameEN.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'FIRST_NAME' | translate }} ({{ 'ENGLISH' | translate }})</mat-label>
                    <input matInput type="text" id="firstnameEN" name="firstnameEN" [(ngModel)]="appForm.firstnameEN"
                      [required]="template.personalDetail.firstnameEN.required" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                  </mat-form-field>
                </div>
                <div class="col-md-5" *ngIf="template.personalDetail.lastnameEN.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'LAST_NAME' | translate }} ({{ 'ENGLISH' | translate }})</mat-label>
                    <input matInput type="text" id="lastnameEN" name="lastnameEN" [(ngModel)]="appForm.lastnameEN"
                      [required]="template.personalDetail.lastnameEN.required" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4" *ngIf="template.personalDetail.idCard.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'ID_CARD' | translate }}</mat-label>
                    <input matInput [formControl]="f.fIdCard" type="text" id="idCard" name="idCard"
                      [(ngModel)]="appForm.idCard" [required]="template.personalDetail.idCard.required" digitOnly
                      onKeyPress="if(this.value.length === 13) return false;"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                    <mat-error *ngIf="f.fIdCard.invalid">{{IdError}}</mat-error>
                  </mat-form-field>
                </div>
                <div class="col-md-4" *ngIf="template.personalDetail.birth.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'BIRTHDAY' | translate }}</mat-label>
                    <input matInput type="text" id="birth" name="birth" [matDatepicker]="birthDate"
                      [(ngModel)]="appForm.birth" readonly (click)="birthDate.open()"
                      (dateInput)="onChangeBirthday($event.target.value)"
                      [required]="template.personalDetail.birth.required" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag" [max]="today">
                    <mat-datepicker-toggle matSuffix [for]="birthDate"></mat-datepicker-toggle>
                    <mat-datepicker #birthDate></mat-datepicker>
                  </mat-form-field>
                </div>
                <!-- <div class="col-md-2" *ngIf="template.personalDetail.birth.visible && !template.isExpress">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'AGE' | translate }}</mat-label>
                    <input matInput type="number" id="age" name="age" [(ngModel)]="appForm.age" disabled
                      [required]="template.personalDetail.age.required" [ngModelOptions]="{standalone: true}">
                  </mat-form-field>
                </div> -->
                <div class="col-md-4" *ngIf="template.personalDetail.email.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'EMAIL' | translate }}</mat-label>
                    <input matInput type="text" id="email" name="email" [formControl]="f.email"
                      [(ngModel)]="appForm.email" [required]="template.personalDetail.email.required">
                    <mat-hint align="start" class="text-red">
                      <div *ngIf="f.email.invalid && (submitted || f.email.touched)">
                        <div *ngIf="f.email.errors?.pattern">
                          Please enter a valid email address.
                        </div>
                      </div>
                    </mat-hint>
                  </mat-form-field>
                </div>
                <div class="col-md-4" *ngIf="template.personalDetail.phone.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'PHONE' | translate }}</mat-label>
                    <input matInput type="text" id="phone" name="phone" [formControl]="f.phone"
                      [(ngModel)]="appForm.phone" [required]="template.personalDetail.phone.required" digitOnly
                      onKeyPress="if(this.value.length === 10) return false;">
                    <mat-hint align="start" class="text-red">
                      <div *ngIf="f.phone.invalid && (submitted || f.phone.touched)">
                        <div *ngIf="f.phone.errors?.pattern">
                          Please enter a valid phone.
                        </div>
                      </div>
                    </mat-hint>
                  </mat-form-field>
                </div>
                <div class="col-md-4" *ngIf="template.personalDetail.reservePhone.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'RESERVE_PHONE' | translate }}</mat-label>
                    <input matInput type="text" id="reservePhone" name="reservePhone" [formControl]="f.reservePhone"
                      [(ngModel)]="appForm.reservePhone" [required]="template.personalDetail.reservePhone.required"
                      digitOnly onKeyPress="if(this.value.length === 10) return false;">
                    <mat-hint align="start" class="text-red">
                      <div *ngIf="f.reservePhone.invalid && (submitted || f.reservePhone.touched)">
                        <div *ngIf="f.reservePhone.errors?.pattern">
                          Please enter a valid phone.
                        </div>
                      </div>
                    </mat-hint>
                  </mat-form-field>
                </div>
                <!-- <div class="col-md-6" *ngIf="template.personalDetail.facebook.visible">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ 'FACEBOOK' | translate }}</mat-label>
                    <input matInput placeholder="https://www.facebook.com/bank.shocky" type="text" id="facebook" name="facebook" [(ngModel)]="appForm.facebook"
                      [required]="template.personalDetail.facebook.required">
                  </mat-form-field>
                </div> -->
              </div>
              <div class="box-dashed" *ngIf="template.personalDetail.address.visible" style="padding-bottom: 0;">
                <p>{{ 'ADDRESS' | translate }}</p>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'ADDRESS_NO' | translate }}</mat-label>
                      <input matInput type="text" id="addressNo" name="addressNo" [(ngModel)]="appForm.addressNo"
                        [required]="template.personalDetail.address.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'ROAD' | translate }}</mat-label>
                      <input matInput type="text" id="road" name="road" [(ngModel)]="appForm.road"
                        [required]="template.personalDetail.address.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field [color]="primary" appearance="outline" class="fit-content">
                      <mat-label>{{ 'PROVINCE' | translate }}</mat-label>
                      <mat-select id="province" name="province" [(ngModel)]="appForm.refProvince"
                        [required]="template.personalDetail.address.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                        <mat-select-filter [placeholder]="'Filter'" [displayMember]="'label'" [array]="provinceList"
                          (filteredReturn)="filteredList =$event">
                        </mat-select-filter>
                        <mat-option *ngFor="let province of filteredList" [value]="province.value"
                          (click)="getDistrict(province.value)">
                          {{province.label}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-md-3">
                    <!-- <mat-form-field appearance="outline">
                      <mat-label>{{ 'PROVINCE' | translate }}</mat-label>
                      <input matInput type="text" id="province" name="province" [(ngModel)]="appForm.province"
                        [required]="template.personalDetail.address.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field> -->
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'DISTRICT' | translate }}</mat-label>
                      <!-- <input matInput type="text" id="district" name="district" [(ngModel)]="appForm.district"
                        [required]="template.personalDetail.address.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag"> -->
                      <mat-select id="district" name="district" [(ngModel)]="appForm.refDistrict"
                        [required]="template.personalDetail.address.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="((successFlag || isDisabled) && !editFlag) || !appForm.refProvince">
                        <mat-select-filter [placeholder]="'Filter'" [displayMember]="'label'" [array]="districtList"
                          (filteredReturn)="filteredDistricts =$event">
                        </mat-select-filter>
                        <mat-option *ngFor="let district of filteredDistricts" [value]="district.value"
                          (click)="getSubDistrict(district.value)">
                          {{district.label}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-md-3">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'SUB_DISTRICT' | translate }}</mat-label>
                      <mat-select id="district" name="district" [(ngModel)]="appForm.refSubDistrict"
                        [required]="template.personalDetail.address.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="((successFlag || isDisabled) && !editFlag) || !appForm.refDistrict || !appForm.refProvince">
                        <mat-select-filter [placeholder]="'Filter'" [displayMember]="'label'" [array]="subDistrictList"
                          (filteredReturn)="filteredSubDistricts =$event">
                        </mat-select-filter>
                        <mat-option *ngFor="let sub of filteredSubDistricts" [value]="sub.value">
                          {{sub.label}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-md-2">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'POSTCODE' | translate }}</mat-label>
                      <input matInput type="text" id="postcode" name="postcode" [formControl]="f.postcode"
                        [(ngModel)]="appForm.postcode" [required]="template.personalDetail.address.required" digitOnly
                        onKeyPress="if(this.value.length === 5) return false;">
                      <mat-hint align="start" class="text-red">
                        <div *ngIf="f.postcode.invalid && (submitted || f.postcode.touched)">
                          <div *ngIf="f.postcode.errors?.pattern">
                            Please enter a valid postcode.
                          </div>
                        </div>
                      </mat-hint>
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Work Experience -->
          <div class="card" *ngIf="template.workExperience.active">
            <div class="card-body">
              <div class="topic">
                <mat-icon>work</mat-icon>
                <p>{{ 'WORK_EXP' | translate }}</p>
                <span *ngIf="!isDisabled">{{ 'WORK_EXP_SUB' | translate }}</span>
              </div>
              <div *ngFor="let work of appForm.workExperience.work; let i = index" class="box-dashed m-b-10">
                <p>
                  {{ 'WORK_EXP' | translate }} ({{ i + 1 }})
                  <button *ngIf="!isDisabled" mat-icon-button type="button" class="text-gray"
                    (click)="work.deletion = true" [disabled]="work.deletion">
                    <mat-icon>delete</mat-icon>
                  </button>
                </p>
                <div *ngIf="work.deletion" class="deletion">
                  <span>{{ 'DELETION' | translate }}</span>
                  <button mat-button type="button" color="warn" (click)="removeWorkExperience(i)">
                    {{ 'REMOVE' | translate }}
                  </button>
                  <button mat-stroked-button type="button" (click)="work.deletion = false">
                    {{ 'CANCEL' | translate }}
                  </button>
                </div>
                <div class="row">
                  <div class="col-md-6" *ngIf="template.workExperience.position.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'POSITION' | translate }}</mat-label>
                      <input matInput type="text" id="position{{i}}" [(ngModel)]="work.position"
                        [required]="template.workExperience.position.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                  <div class="col-md-6" *ngIf="template.workExperience.company.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'COMPANY' | translate }}</mat-label>
                      <input matInput type="text" id="company{{i}}" [(ngModel)]="work.company"
                        [required]="template.workExperience.company.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4" *ngIf="template.workExperience.start.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'PERIOD_FROM' | translate }}</mat-label>
                      <input matInput type="text" id="start{{i}}" name="start" [matDatepicker]="startDate"
                        [(ngModel)]="work.start" readonly (click)="startDate.open()"
                        [required]="template.workExperience.start.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                      <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
                      <mat-datepicker #startDate></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div class="col-md-2 checkbox-margin" *ngIf="template.workExperience.start.visible">
                    <mat-checkbox [(ngModel)]="work.isPresent" class="is-present" [ngModelOptions]="{standalone: true}"
                      [disabled]="(successFlag || isDisabled) && !editFlag">
                      {{ 'PRESENT' | translate }}</mat-checkbox>
                  </div>
                  <div *ngIf="template.workExperience.end.visible && !work.isPresent" class="col-md-4">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'PERIOD_TO' | translate }}</mat-label>
                      <input matInput type="text" id="end{{i}}" name="end" [matDatepicker]="endDate"
                        [(ngModel)]="work.end" readonly (click)="endDate.open()"
                        [required]="template.workExperience.end.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                      <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                      <mat-datepicker #endDate></mat-datepicker>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12" *ngIf="template.workExperience.duty.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'RESPONSIBILITY' | translate }}</mat-label>
                      <textarea matInput type="text" id="duty{{i}}" rows="3" [(ngModel)]="work.duty"
                        [required]="template.workExperience.duty.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag"></textarea>
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div *ngIf="!isDisabled" class="add-more">
                <button mat-flat-button type="button" color="primary" (click)="addWorkExperience()">
                  <mat-icon>add</mat-icon>
                  {{ 'ADD_WORK_EXP' | translate }}
                </button>
              </div>
            </div>
          </div>

          <!-- Education -->
          <div class="card" *ngIf="template.education.active">
            <div class="card-body">
              <div class="topic">
                <mat-icon>school</mat-icon>
                <p>{{ 'EDUCATION' | translate }}</p>
                <span *ngIf="!isDisabled">{{ 'EDUCATION_SUB' | translate }}</span>
              </div>
              <div *ngFor="let education of appForm.education; let i = index" class="box-dashed m-b-10">
                <p>
                  {{ 'EDUCATION' | translate }} ({{ i + 1 }})
                  <button *ngIf="!isDisabled" mat-icon-button type="button" class="text-gray"
                    (click)="education.deletion = true" [disabled]="education.deletion">
                    <mat-icon>delete</mat-icon>
                  </button>
                </p>
                <div *ngIf="education.deletion" class="deletion">
                  <span>{{ 'DELETION' | translate }}</span>
                  <button mat-button type="button" color="warn" (click)="removeEducation(i)">
                    {{ 'REMOVE' | translate }}
                  </button>
                  <button mat-stroked-button type="button" (click)="education.deletion = false">
                    {{ 'CANCEL' | translate }}
                  </button>
                </div>
                <div class="row">
                  <div class="col-md-6" *ngIf="template.education.refDegree.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'DEGREE' | translate }}</mat-label>
                      <mat-select *ngIf="language === 'en'" id="refDegree{{i}}" [(ngModel)]="education.refDegree"
                        [ngModelOptions]="{ standalone: true }" [required]="template.education.refDegree.required"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                        <mat-option *ngFor="let degree of degreesEN" [value]="degree.value">
                          {{ degree.label }}
                        </mat-option>
                      </mat-select>
                      <mat-select *ngIf="language === 'th'" id="refDegree{{i}}" [(ngModel)]="education.refDegree"
                        [ngModelOptions]="{ standalone: true }" [required]="template.education.refDegree.required"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                        <mat-option *ngFor="let degree of degreesTH" [value]="degree.value">
                          {{ degree.label }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-md-3" *ngIf="template.education.gpa.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'GPA' | translate }}</mat-label>
                      <input matInput type="text" id="gpa{{i}}" name="gpa" [formControl]="f.gpa"
                        [(ngModel)]="education.gpa" [required]="template.education.gpa.required">
                      <mat-hint align="start" class="text-red">
                        <div *ngIf="f.gpa.invalid && (submitted || f.gpa.touched)">
                          <div *ngIf="f.gpa.errors?.maxLength">
                            Please enter a valid gpa.
                          </div>
                        </div>
                      </mat-hint>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6" *ngIf="template.education.university.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'UNIVERSITY' | translate }}</mat-label>
                      <input matInput type="text" id="university{{i}}" [(ngModel)]="education.university"
                        [ngModelOptions]="{standalone: true}" [required]="template.education.university.required"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                  <div class="col-md-6" *ngIf="template.education.major.visible">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'MAJOR' | translate }}</mat-label>
                      <input matInput type="text" id="major{{i}}" [(ngModel)]="education.major"
                        [ngModelOptions]="{standalone: true}" [required]="template.education.major.required"
                        [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div *ngIf="!isDisabled" class="add-more">
                <button mat-flat-button type="button" color="primary" (click)="addEducation()">
                  <mat-icon>add</mat-icon>
                  {{ 'ADD_EDUCATION' | translate }}
                </button>
              </div>
            </div>
          </div>

          <!-- Hard Skills -->
          <div class="card" *ngIf="template.hardSkill.active">
            <div class="card-body">
              <div class="topic">
                <mat-icon>highlight</mat-icon>
                <p>{{ 'HARD_SKILLS' | translate }}</p>
                <span *ngIf="!isDisabled">{{ 'HARD_SKILLS_SUB' | translate }}</span>
              </div>
              <div *ngIf="!isDisabled">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'HARD_SKILL' | translate }}</mat-label>
                      <input matInput (keyup.enter)="addHardSkill()" [(ngModel)]="hardSkill.keyword"
                        [ngModelOptions]="{standalone: true}"
                        [disabled]="appForm.hardSkill.length === 20 || isDisabled">
                      <mat-hint align="end">{{ 'MAX_HARD_SKILLS' | translate }}</mat-hint>
                      <mat-hint align="start" class="text-red">
                        <span *ngIf="hardSkill.required">{{ 'HARD_SKILLS_REQUIRED' | translate }}</span>
                        <span *ngIf="hardSkill.duplication">{{ 'HARD_SKILLS_DUPLICATE' | translate }}</span>
                      </mat-hint>
                    </mat-form-field>
                  </div>
                </div>
                <div class="add-more">
                  <button mat-flat-button type="button" color="primary" (click)="addHardSkill()"
                    [disabled]="appForm.hardSkill.length === 20 || isDisabled">
                    <mat-icon>add</mat-icon>
                    {{ 'ADD_HARD_SKILL' | translate }}
                  </button>
                </div>
                <div class="text-right text-gray">
                  <span>{{ appForm.hardSkill.length }}/20</span>
                </div>
              </div>
              <div class="box-dashed">
                <mat-chip-list>
                  <mat-chip color="primary" selected>{{ 'HARD_SKILLS' | translate }}</mat-chip> :
                  <mat-chip *ngFor="let value of appForm.hardSkill; let i = index">
                    {{ value }}
                    <mat-icon *ngIf="!isDisabled" matChipRemove (click)="removeHardSkill(i)">cancel</mat-icon>
                  </mat-chip>
                </mat-chip-list>
              </div>
            </div>
          </div>

          <!-- Soft Skills -->
          <div class="card" *ngIf="template.softSkill.active">
            <div class="card-body">
              <div class="topic">
                <mat-icon>highlight</mat-icon>
                <p>{{ 'SOFT_SKILLS' | translate }}</p>
                <span *ngIf="!isDisabled">{{ 'SOFT_SKILLS_SUB' | translate }}</span>
              </div>
              <div *ngIf="!isDisabled">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'SOFT_SKILL' | translate }}</mat-label>
                      <input matInput (keyup.enter)="addSoftSkill()" [(ngModel)]="softSkill.keyword"
                        [ngModelOptions]="{standalone: true}" [disabled]="appForm.softSkill.length === 20">
                      <mat-hint align="end">{{ 'MAX_SOFT_SKILLS' | translate }}</mat-hint>
                      <mat-hint align="start" class="text-red">
                        <span *ngIf="softSkill.required">{{ 'SOFT_SKILLS_REQUIRED' | translate }}</span>
                        <span *ngIf="softSkill.duplication">{{ 'SOFT_SKILLS_DUPLICATE' | translate }}</span>
                      </mat-hint>
                    </mat-form-field>
                  </div>
                </div>
                <div class="add-more">
                  <button mat-flat-button type="button" color="primary" (click)="addSoftSkill()"
                    [disabled]="appForm.softSkill.length === 20">
                    <mat-icon>add</mat-icon>
                    {{ 'ADD_SOFT_SKILL' | translate }}
                  </button>
                </div>
                <div class="text-right text-gray">
                  <span>{{ appForm.softSkill.length }}/20</span>
                </div>
              </div>
              <div class="box-dashed">
                <mat-chip-list>
                  <mat-chip color="primary" selected>{{ 'SOFT_SKILLS' | translate }}</mat-chip> :
                  <mat-chip *ngFor="let value of appForm.softSkill; let i = index">
                    {{ value }}
                    <mat-icon *ngIf="!isDisabled" matChipRemove (click)="removeSoftSkill(i)">cancel</mat-icon>
                  </mat-chip>
                </mat-chip-list>
              </div>
            </div>
          </div>

          <!-- Certifications -->
          <div class="card" *ngIf="template.certificate.active">
            <div class="card-body">
              <div class="topic">
                <mat-icon>turned_in</mat-icon>
                <p>{{ 'CERTIFICATIONS' | translate }}</p>
                <span *ngIf="!isDisabled">{{ 'CERTIFICATIONS_SUB' | translate }}</span>
              </div>
              <div *ngIf="!isDisabled">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8">
                    <mat-form-field appearance="outline">
                      <mat-label>{{ 'CERTIFICATION' | translate }}</mat-label>
                      <input matInput (keyup.enter)="addCertificate()" [(ngModel)]="certificate.keyword"
                        [ngModelOptions]="{standalone: true}" [disabled]="appForm.certificate.length === 5">
                      <mat-hint align="end">{{ 'MAX_CERT' | translate }}</mat-hint>
                      <mat-hint align="start" class="text-red">
                        <span *ngIf="certificate.required">{{ 'CERT_REQUIRED' | translate }}</span>
                        <span *ngIf="certificate.duplication">{{ 'CERT_DUPLICATE' | translate }}</span>
                      </mat-hint>
                    </mat-form-field>
                  </div>
                </div>
                <div class="add-more">
                  <button mat-flat-button type="button" color="primary" (click)="addCertificate()"
                    [disabled]="appForm.certificate.length === 5">
                    <mat-icon>add</mat-icon>
                    {{ 'ADD_CERT' | translate }}
                  </button>
                </div>
                <div class="text-right text-gray">
                  <span>{{ appForm.certificate.length }}/5</span>
                </div>
              </div>
              <div class="box-dashed">
                <mat-chip-list>
                  <mat-chip color="primary" selected>{{ 'CERTIFICATIONS' | translate }}</mat-chip> :
                  <mat-chip *ngFor="let value of appForm.certificate; let i = index">
                    {{ value }}
                    <mat-icon *ngIf="!isDisabled" matChipRemove (click)="removeCertificate(i)">cancel</mat-icon>
                  </mat-chip>
                </mat-chip-list>
              </div>
            </div>
          </div>

          <!-- Resume -->
          <div class="card" *ngIf="template.uploadCV.active">
            <mat-progress-bar *ngIf="loadingUpload" mode="indeterminate"></mat-progress-bar>
            <div class="card-body">
              <div class="topic">
                <mat-icon>account_box</mat-icon>
                <p>{{ 'RESUME' | translate }}</p>
                <span *ngIf="!isDisabled">{{ 'RESUME_SUB' | translate }}</span>
              </div>
              <div class="topic"
                *ngIf="appForm.attachment.imgaeURL && (appForm.attachment.type.length > 5 && appForm.attachment.type.toString().substring(0, 5) === 'image')">
                <span>ตัวอย่างรูปที่อัพโหลด</span>
              </div>
              <div class="row">
                <div class="offset-lg-2 col-lg-8">
                  <div
                    *ngIf="appForm.attachment.imgaeURL && (appForm.attachment.type.length > 5 && appForm.attachment.type.toString().substring(0, 5) === 'image')"
                    class="question-image">
                    <img [src]="appForm.attachment.imgaeURL" class="w-100">
                  </div>
                </div>
              </div>
              <div class="upload-file box-dashed">
                <p class="file-preview">
                  <mat-icon>insert_drive_file</mat-icon>
                  <span *ngIf="!appForm.attachment.originalName">{{ 'NO_FILE' | translate }}</span>
                  <span *ngIf="appForm.attachment.originalName && detailFlag" class="text-gray link underline"
                    (click)="downloadPress(appForm.attachment)">{{ appForm.attachment.originalName }}</span>
                  <span *ngIf="appForm.attachment.originalName && !detailFlag"
                    class="text-gray">{{ appForm.attachment.originalName }}</span>
                  <mat-icon *ngIf="appForm.attachment.originalName && !isDisabled" class="delete"
                    (click)="clearFile(appForm.attachment, appForm); fileInput.value = ''">
                    cancel
                  </mat-icon>
                </p>
                <p><small>{{ 'ATTACH_RESUME' | translate }} (pdf, doc, docx, jpeg, png -
                    {{ 'MAX_UPLOAD' | translate }})</small></p>
                <button *ngIf="!isDisabled" mat-flat-button type="button" color="primary" (click)="fileInput.click()"
                  [disabled]="loadingUpload">
                  <mat-icon>cloud_upload</mat-icon> {{ 'UPLOAD_RESUME' | translate }}
                  <input #fileInput type="file" ng2FileSelect [uploader]="uploader"
                    (change)="uploadFile(appForm.attachment, $event.target.files, true,999)" accept="*"
                    style="display:none;" />
                </button>
              </div>
            </div>
          </div>
          <div class="footer">
            <button nbButton status="basic" nbStepperPrevious>{{ 'PREV' | translate }}</button>
            <button nbButton type="button" (click)="validation() ? stepper.next() : false" [nbSpinner]="loadingButton">
              {{ 'NEXT' | translate }}
            </button>
          </div>
        </nb-step>

        <!-- --------------------------------------------------------------- -->
        <!-- STEP 3 -->
        <nb-step *ngIf="appForm.questions.length > 0">
          <div class="row">
            <div *ngIf="detailFlag" class="col-md-12" style="text-align: right;">
              <span (click)="setEdit()" class="btn-link">
                <nb-icon class="font-inherit m-r-5" *ngIf="!editFlag" icon="eye-outline">
                </nb-icon>
                <nb-icon class="font-inherit m-r-5" *ngIf="editFlag" icon="edit-2-outline">
                </nb-icon>
                {{ buttonText.toUpperCase() }}
              </span><br>
            </div>
          </div>
          <!-- Questions -->
          <div id="question{{iQuestion}}" class="card"
            *ngFor="let question of appForm.questions; let iQuestion = index;">
            <mat-progress-bar *ngIf="question.isLoading" mode="indeterminate"></mat-progress-bar>
            <div class="card-body">

              <div class="topic" *ngIf="question.type === InputType.Label" style="margin-bottom: 1rem;">
                <p>{{ question.title }} <span class="text-red" *ngIf="question.required">*</span></p>
                <span *ngIf="question.showSubTitle">{{ question.subTitle }}</span>
              </div>
              <div class="topic" *ngIf="question.type !== InputType.Label">
                <mat-icon>help_outline</mat-icon>
                <p>{{ question.title }} <span class="text-red" *ngIf="question.required">*</span></p>
                <span *ngIf="question.showSubTitle">{{ question.subTitle }}</span>
              </div>
              <div *ngIf="!detailFlag" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <div *ngIf="question.imgaeURL" class="question-image">
                    <img [src]="question.imgaeURL" class="w-100">
                  </div>
                </div>
              </div>
              <div class="topic" *ngIf="question.answer.attachment.imgaeURL && !detailFlag">
                <span>ตัวอย่างรูปที่อัพโหลด</span>
              </div>
              <div class="row">
                <div class="offset-lg-2 col-lg-8">
                  <div
                    *ngIf="question.answer.attachment.imgaeURL && (question.answer.attachment.type.length > 5 && question.answer.attachment.type.toString().substring(0, 5) === 'image')"
                    class="question-image">
                    <img [src]="question.answer.attachment.imgaeURL" class="w-100">
                  </div>
                </div>
              </div>

              <div *ngIf="question.type === InputType.Input">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8">
                    <mat-form-field appearance="outline">
                      <input matInput type="text" [(ngModel)]="question.answer.input" [required]="question.required"
                        [ngModelOptions]="{standalone: true}" [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div *ngIf="question.type === InputType.TextArea">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8">
                    <mat-form-field appearance="outline">
                      <textarea matInput type="text" [(ngModel)]="question.answer.textArea" rows="3"
                        [required]="question.required" [ngModelOptions]="{standalone: true}"
                        [disabled]="(successFlag || isDisabled) && !editFlag"></textarea>
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div *ngIf="question.type === InputType.Radio">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8">
                    <mat-radio-group [(ngModel)]="question.answer.selected" [required]="question.required"
                      [ngModelOptions]="{standalone: true}" [disabled]="(successFlag || isDisabled) && !editFlag">
                      <div class="row">
                        <div *ngFor="let option of question.answer.options; let i = index" class="m-b-15"
                          [ngClass]="{ 'col-md-6' : option.imgaeURL, 'col-md-12': !option.imgaeURL}">
                          <div *ngIf="option.imgaeURL" class="answer-image"
                            [ngClass]="{ 'active': question.answer.selected === i }"
                            (click)="question.answer.selected = i">
                            <img [src]="option.imgaeURL">
                          </div>
                          <mat-radio-button [value]="i">
                            {{ option.label }}
                          </mat-radio-button>
                        </div>
                        <div class="col-md-12">
                          <mat-radio-button *ngIf="question.answer.hasOther" [value]="question.answer.options.length">
                            {{ question.answer.otherLabel }}
                          </mat-radio-button>
                        </div>
                      </div>
                    </mat-radio-group>
                    <mat-form-field appearance="outline"
                      *ngIf="question.answer.selected === question.answer.options.length">
                      <mat-label>{{ question.answer.otherLabel }}</mat-label>
                      <input matInput type="text" [(ngModel)]="question.answer.otherInput" required
                        [ngModelOptions]="{standalone: true}" [disabled]="(successFlag || isDisabled) && !editFlag">
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div *ngIf="question.type === InputType.ChcekBox">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8">
                    <div class="row">
                      <div *ngFor="let option of question.answer.options; let i = index" class="m-b-15"
                        [ngClass]="{ 'col-md-6' : option.imgaeURL, 'col-md-12': !option.imgaeURL}">
                        <div *ngIf="option.imgaeURL" class="answer-image" [ngClass]="{ 'active': option.checked }"
                          (click)="option.checked = !option.checked">
                          <img [src]="option.imgaeURL">
                        </div>
                        <mat-checkbox [(ngModel)]="option.checked" [ngModelOptions]="{standalone: true}"
                          [disabled]="(successFlag || isDisabled) && !editFlag">
                          {{ option.label }}
                        </mat-checkbox>
                      </div>
                      <div *ngIf="question.answer.hasOther" class="col-md-12">
                        <mat-checkbox [(ngModel)]="question.answer.otherChecked" [ngModelOptions]="{standalone: true}"
                          [disabled]="(successFlag || isDisabled) && !editFlag">
                          {{ question.answer.otherLabel }}
                        </mat-checkbox>
                        <mat-form-field appearance="outline" *ngIf="question.answer.otherChecked">
                          <mat-label>{{ question.answer.otherLabel }}</mat-label>
                          <input matInput type="text" [(ngModel)]="question.answer.otherInput" required
                            [ngModelOptions]="{standalone: true}" [disabled]="(successFlag || isDisabled) && !editFlag">
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="question.type === InputType.Dropdown" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <mat-form-field appearance="outline" class="fit-content">
                    <mat-label>{{ 'SELECT_ANSWER' | translate }}</mat-label>
                    <mat-select [(ngModel)]="question.answer.selected" [required]="question.required"
                      [ngModelOptions]="{standalone: true}" [disabled]="(successFlag || isDisabled) && !editFlag">
                      <mat-option *ngFor="let option of question.answer.options; let i = index" [value]="i">
                        {{ option.label }}
                      </mat-option>
                      <mat-option *ngIf="question.answer.hasOther" [value]="question.answer.options.length">
                        {{ question.answer.otherLabel }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline"
                    *ngIf="question.answer.selected === question.answer.options.length">
                    <mat-label>{{ question.answer.otherLabel }}</mat-label>
                    <input matInput type="text" [(ngModel)]="question.answer.otherInput" required
                      [ngModelOptions]="{standalone: true}" [disabled]="(successFlag || isDisabled) && !editFlag">
                  </mat-form-field>
                </div>
              </div>

              <div *ngIf="question.type === InputType.ParentChild" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <mat-form-field appearance="outline" class="fit-content">
                    <mat-label>{{ 'SELECT_ANSWER' | translate }}</mat-label>
                    <mat-select [(ngModel)]="question.parentSelected" [ngModelOptions]="{standalone: true}"
                      [required]="question.required" [disabled]="(successFlag || isDisabled) && !editFlag">
                      <mat-option *ngFor="let option of question.parentChild; let i = index;" [value]="i">
                        {{ option.name }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <div *ngIf="getChild(question)">
                    <div *ngIf="!getChild(question).isMultiAnswer">
                      <mat-form-field appearance="outline" class="fit-content">
                        <mat-label>{{ 'SELECT_ANSWER' | translate }}</mat-label>
                        <mat-select [(ngModel)]="question.childSelected" [ngModelOptions]="{standalone: true}"
                          [required]="getChild(question).required"
                          [disabled]="(successFlag || isDisabled) && !editFlag">
                          <mat-option *ngFor="let option of getChild(question).children; let i = index;" [value]="i">
                            {{ option.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div *ngIf="getChild(question).isMultiAnswer">
                      <mat-form-field appearance="outline" class="fit-content">
                        <mat-label>{{ 'SELECT_ANSWER' | translate }}</mat-label>
                        <mat-select [formControl]="question.multiChilds" multiple>
                          <mat-select-trigger>
                            {{question.multiChilds.value ? question.multiChilds.value[0] : ''}}
                            <span *ngIf="question.multiChilds.value?.length > 1" class="additional-selection">
                              (+{{question.multiChilds.value.length - 1}}
                              {{question.multiChilds.value?.length === 2 ? 'other' : 'others'}})
                            </span>
                          </mat-select-trigger>
                          <mat-option *ngFor="let option of getChild(question).children" [value]="option.name"
                            [disabled]="(successFlag || isDisabled) && !editFlag">
                            {{ option.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="question.type === InputType.Upload">
                <div class="upload-file box-dashed m-0">
                  <p class="file-preview">
                    <mat-icon>insert_drive_file</mat-icon>
                    <span *ngIf="!question.answer.attachment.originalName">{{ 'NO_FILE' | translate }}</span>
                    <span *ngIf="question.answer.attachment.originalName && !isDisabled">
                      {{ question.answer.attachment.originalName }}
                    </span>
                    <span *ngIf="question.answer.attachment.originalName && isDisabled && detailFlag"
                      class="text-gray link underline" (click)="downloadPress(question.answer.attachment)">
                      {{ question.answer.attachment.originalName }}
                    </span>
                    <span *ngIf="question.answer.attachment.originalName && isDisabled  && !detailFlag"
                      class="text-gray">
                      {{ question.answer.attachment.originalName }}
                    </span>
                    <mat-icon *ngIf="question.answer.attachment.originalName && (!isDisabled || editFlag)"
                      class="delete" (click)="clearFile(question.answer.attachment, question);">
                      cancel
                    </mat-icon>
                  </p>.png, .jpg และ .jpeg
                  <p><small>{{ 'ATTACH_UPLOAD' | translate }} ( jpg, jpeg, png -
                      {{ 'MAX_UPLOAD' | translate }})</small></p>
                  <!-- <p><small>Attach a file. (pdf, doc, docx, jpeg, png - Max 15 MB)</small></p> -->
                  <button *ngIf="!isDisabled || editFlag" mat-flat-button type="button" color="primary"
                    (click)="fileInput.click()" [disabled]="question.isLoading">
                    <mat-icon class="m-r-5">cloud_upload</mat-icon> {{ 'UPLOAD_UPLOAD' | translate }}
                    <input #fileInput type="file" ng2FileSelect [uploader]="uploader"
                      (change)="uploadFile(question.answer.attachment, $event.target.files, false, iQuestion,question)"
                      accept="*" style="display:none;" />
                  </button>
                </div>
              </div>

              <div *ngIf="question.type === InputType.Linear" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <mat-radio-group [(ngModel)]="question.answer.linearValue" [ngModelOptions]="{standalone: true}"
                    [required]="question.required" [disabled]="isDisabled">
                    <div class="linear">
                      <div *ngIf="question.linear.fromLabel">{{ question.linear.fromLabel }}</div>
                      <div *ngFor="let linearOption of question.answer.linearOptions">
                        <p class="m-l-5">{{ linearOption.label }}</p>
                        <mat-radio-button [value]="linearOption.label"></mat-radio-button>
                      </div>
                      <div *ngIf="question.linear.toLabel">{{ question.linear.toLabel }}</div>
                    </div>
                  </mat-radio-group>
                </div>
              </div>

              <div *ngIf="question.type === InputType.RadioGrid" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <table class="grid">
                    <tr>
                      <th>&nbsp;</th>
                      <th>
                        <div class="grid-item">
                          <div *ngFor="let col of question.grid.columns">
                            {{ col.label }}
                          </div>
                        </div>
                      </th>
                    </tr>
                    <tbody>
                      <tr *ngFor="let gridRadio of question.answer.gridRadio">
                        <td>{{ gridRadio.rowName }}</td>
                        <td>
                          <mat-radio-group [(ngModel)]="gridRadio.value" [ngModelOptions]="{standalone: true}"
                            [required]="question.required" [disabled]="(successFlag || isDisabled) && !editFlag">
                            <div class="grid-item">
                              <div *ngFor="let col of question.grid.columns">
                                <mat-radio-button [value]="col.label"></mat-radio-button>
                              </div>
                            </div>
                          </mat-radio-group>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div *ngIf="question.type === InputType.ChcekBoxGrid" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <table class="grid">
                    <tr>
                      <th>&nbsp;</th>
                      <th>
                        <div class="grid-item">
                          <div *ngFor="let col of question.grid.columns">
                            {{ col.label }}
                          </div>
                        </div>
                      </th>
                    </tr>
                    <tbody>
                      <tr *ngFor="let gridCheckbox of question.answer.gridCheckbox">
                        <td>{{ gridCheckbox.rowName }}</td>
                        <td>
                          <div class="grid-item">
                            <div *ngFor="let col of gridCheckbox.columns">
                              <mat-checkbox [(ngModel)]="col.checked" [ngModelOptions]="{standalone: true}"
                                [disabled]="(successFlag || isDisabled) && !editFlag"></mat-checkbox>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div *ngIf="question.type === InputType.Date" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <div class="text-center">
                    <mat-form-field appearance="outline" style="width: 296px; display: inline-block !important;">
                      <mat-label>Date</mat-label>
                      <input matInput type="text" id="date_{{iQuestion}}" name="date" [matDatepicker]="picker"
                        [(ngModel)]="question.answer.date" readonly (click)="picker.open()"
                        [required]="question.required" [ngModelOptions]="{standalone: true}" [disabled]="isDisabled">
                      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div *ngIf="question.type === InputType.Time" class="row">
                <div class="offset-lg-2 col-lg-8">
                  <div class="text-center">
                    <ngb-timepicker id="time_{{iQuestion}}" [(ngModel)]="question.answer.time"
                      [ngModelOptions]="{standalone: true}" [minuteStep]="minuteStep" [spinners]="false"
                      [required]="question.required" [disabled]="(successFlag || isDisabled) && !editFlag"
                      style="display: inline-block;">
                    </ngb-timepicker>
                  </div>
                </div>
              </div>

            </div>
          </div>
          <div class="footer">
            <button nbButton status="basic" nbStepperPrevious>{{ 'PREV' | translate }}</button>
            <button *ngIf="!isDisabled && !successFlag" nbButton type="button"
              (click)="validation() ? stepper.next() : false">
              {{ 'NEXT' | translate }}
            </button>
            <button *ngIf="successFlag && !detailFlag" nbButton status="primary" type="submit">
              {{ 'SUBMIT' | translate }}
            </button>
            <button *ngIf="saveFlag" nbButton status="primary" type="submit">
              {{ 'SUBMIT' | translate }}
            </button>
          </div>
        </nb-step>

        <!-- --------------------------------------------------------------- -->
        <!-- STEP 4 -->
        <nb-step [hidden]="isDisabled">
          <div class="card">
            <div class="card-body">
              <div class="topic">
                <mat-icon>check_circle_outline</mat-icon>
              </div>
              <div *ngIf="!isDisabled">
                <div class="row">
                  <div class="offset-lg-2 col-lg-8 text-center">
                    <div class="text-gray m-b-20">
                      <span>{{ 'TERMS_DETAIL' | translate }}</span>
                      <!-- <span class="link underline m-l-5" (click)="openPopupConsent()">
                        {{ 'PERSONAL_STATEMENT' | translate }}
                      </span> -->
                    </div>
                    <div class="terms" (click)="openPopupConsent()">
                      <mat-checkbox [(ngModel)]="isAgree" [ngModelOptions]="{standalone: true}" disabled>
                        {{ 'TERMS' | translate }}
                      </mat-checkbox>
                      <button mat-icon-button type="button">
                        <mat-icon class="showPhoto">help_outline</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="!isPreview" class="footer">
            <!-- <button mat-flat-button type="button" (click)="closeWindow()">
                <mat-icon>close</mat-icon> {{ 'CLOSE' | translate }}
              </button> -->
            <!-- <button mat-flat-button color="primary" type="submit" [disabled]="!isAgree">
              <mat-icon>send</mat-icon> {{ 'SUBMIT' | translate }}
            </button> -->

            <button nbButton status="basic" nbStepperPrevious>{{ 'PREV' | translate }}</button>
            <button nbButton status="primary" type="submit" nbStepperNext [disabled]="!isAgree">
              {{ 'SUBMIT' | translate }}
            </button>
          </div>
          <div *ngIf="isPreview" class="footer">
            <button nbButton status="basic" nbStepperPrevious>{{ 'PREV' | translate }}</button>
            <button mat-flat-button type="button" color="primary" (click)="closeWindow()">
              <mat-icon>close</mat-icon> {{ 'CLOSE_PREVIEW' | translate }}
            </button>
          </div>
        </nb-step>
      </nb-stepper>
    </form>
  </div>

  <ng-template #dialog let-data let-ref="dialogRef">
    <div class="card" [nbSpinner]="image.loading" nbSpinnerStatus="primary" nbSpinnerMessage="Loading ...">
      <div class="card-header">
        <div class="title">
          {{ image.originalName }}
          <div class="float-right">
            <button mat-icon-button type="button" (click)="ref.close()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <div class="card-body img-preview" [style.width.px]="utilitiesService.getWidthOfPopupCard()">
        <div *ngIf="!image.loading">
          <img *ngIf="image.url" [src]="image.url" alt="" class="w-100">
        </div>
      </div>
    </div>
  </ng-template>

</div>