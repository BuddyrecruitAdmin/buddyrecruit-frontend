<div class="content-header with-shadow">
  <div class="breadcrumb">
    <h5>
      <span class="link text-gray" (click)="back()">
        <nb-icon icon="arrow-ios-back-outline" style="font-size: 100%;"></nb-icon>Back
      </span>
    </h5>
  </div>
</div>

<nb-card accent="success" [nbSpinner]="loading" nbSpinnerStatus="success" nbSpinnerSize="large"
  nbSpinnerMessage="Loading...">
  <nb-card-header>
    <div class="title">
      <label [nbTooltip]="utilitiesService.setFullname(item)">
        {{ utilitiesService.setFullname(item) }}
      </label>
      <small class="status">
        Status: <label class="label label-gray">{{ item.candidateFlow?.refStage?.name }}</label>
      </small>
    </div>
    <div class="actions">
      <span class="fa fa-star text-orange">&nbsp;</span>
      <span>{{ item.candidateFlow?.weightScore?.accumulativeScore || 0 }}</span>
      <small>/{{ item.candidateFlow?.weightScore?.total || 0 }}</small>
    </div>
  </nb-card-header>
  <nb-card-body>

    <div class="row">
      <div class="col-md-6">

        <!-- Process Flow -->
        <label class="label topic" style="margin-top: 0;">Process Flow</label>
        <div class="m-l-15">
          <div class="text-group">
            <label class="label">Department</label>
            <span>{{ item.candidateFlow?.refJR?.department?.name || '-' }}</span>
          </div>
          <div class="text-group">
            <label class="label">Division</label>
            <span>{{ item.candidateFlow?.refJR?.division?.name || '-' }}</span>
          </div>
          <div class="text-group">
            <label class="label">Job Position</label>
            <span (click)="gotoJR()" class="link underline"
              nbTooltip="See More Candidate">{{ item.candidateFlow?.refJR?.refJD?.position || '-' }}</span>
          </div>
          <div class="text-group">
            <label class="label">Stage</label>
            <span (click)="gotoStage()" class="link underline"
              nbTooltip="See More Job Positon">{{ item.candidateFlow?.refStage?.refMain?.name || '-' }}</span>
          </div>
        </div>

        <!-- Exam Info -->
        <div *ngIf="item.candidateFlow?.examInfo?.flag">
          <label class="label topic">Exam Info</label>
          <div class="m-l-15">
            <div class="text-group">
              <label class="label">Exam Date</label>
              <span>{{ utilitiesService.convertDateTime(item.candidateFlow?.examInfo?.date) || '-' }}</span>
            </div>
            <div *ngIf="item.candidateFlow?.pendingExamInfo?.flag">
              <div class="text-group">
                <label class="label">Available Date</label>
                <span>{{ utilitiesService.convertDate(item.candidateFlow?.pendingExamInfo?.availableDate) || '-' }}</span>
              </div>
              <div class="text-group">
                <label class="label">After Sign Contract</label>
                <span>{{ item.candidateFlow?.pendingExamInfo?.afterSignContract || '-' }}</span>
              </div>
              <div class="text-group">
                <label class="label">Remark</label>
                <span>{{ item.candidateFlow?.pendingExamInfo?.remark || '-' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Exam Score -->
        <div *ngIf="item.candidateFlow?.pendingExamScoreInfo?.flag">
          <label class="label topic">Exam Score</label>
          <div class="m-l-15">
            <div class="text-group">
              <label class="label">Exam Score</label>
              <span>{{ item.candidateFlow?.pendingExamScoreInfo?.examScore || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Exam Remark</label>
              <span>{{ item.candidateFlow?.pendingExamScoreInfo?.examRemark || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Attitude Score</label>
              <span>{{ item.candidateFlow?.pendingExamScoreInfo?.attitudeScore || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Attitude Remark</label>
              <span>{{ item.candidateFlow?.pendingExamScoreInfo?.attitudeRemark || '-' }}</span>
            </div>
          </div>
        </div>

        <!-- Interview Info -->
        <div *ngIf="item.candidateFlow?.pendingInterviewInfo?.flag">
          <label class="label topic">Interview Info</label>
          <div class="m-l-15">
            <div class="text-group">
              <label class="label">Interview Location</label>
              <span>{{ item.candidateFlow?.pendingInterviewInfo?.refLocation?.name || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Interview Date</label>
              <span>{{ utilitiesService.convertDateTime(item.candidateFlow?.pendingInterviewInfo?.startDate) || '-' }}</span>
            </div>
          </div>
        </div>

        <!-- Interview Score -->
        <div *ngIf="item.candidateFlow?.pendingInterviewScoreInfo?.flag">
          <label class="label topic">Interview Score</label>
          <div class="m-l-15">
            <div class="text-group">
              <label class="label">Score</label>
              <span>{{ interviewScore.score || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Average Score</label>
              <span>{{  interviewScore.avgScore || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Result</label>
              <span>{{  interviewScore.result || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Remark</label>
              <span>{{  interviewScore.remark || '-' }}</span>
            </div>
          </div>
        </div>

        <!-- Sign Contract Info -->
        <div *ngIf="item.candidateFlow?.pendingSignContractInfo?.sign?.flag">
          <label class="label topic">Sign Contract Info</label>
          <div class="m-l-15">
            <div class="text-group">
              <label class="label">Sign Contract Date</label>
              <span>{{ utilitiesService.convertDateTimeFromSystem(item.candidateFlow?.pendingSignContractInfo?.sign?.date) || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Agree Start Date</label>
              <span>{{ utilitiesService.convertDate(item.candidateFlow?.pendingSignContractInfo?.agreeStartDate) || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Email Sent Date</label>
              <span>{{ utilitiesService.convertDateTimeFromSystem(item.candidateFlow?.pendingSignContractInfo?.mail?.date) || '-' }}</span>
            </div>
            <div class="text-group">
              <label class="label">Note</label>
              <span>{{ item.candidateFlow?.pendingSignContractInfo?.note || '-' }}</span>
            </div>
          </div>
        </div>

        <!-- Onboard Info -->
        <div *ngIf="item.candidateFlow?.onboard?.flag">
          <label class="label topic">Onboard Info</label>
          <div class="text-group">
            <label class="label">Onboard Date</label>
            <span>{{ utilitiesService.convertDate(item.candidateFlow?.onboard?.date) || '-' }}</span>
          </div>
        </div>

      </div>

      <!-- CV Score -->
      <div class="col-md-6">
        <label class="label topic" style="margin-top: 0;">CV Score</label>
        <div class="m-l-15">
          <div class="m-b-10">
            <div class="label">Work Experience
              <span class="pull-right">
                {{ item.candidateFlow?.weightScore?.workExperience?.accumulativeScore || 0 }}/{{ item.candidateFlow?.weightScore?.workExperience?.total || 0 }}
              </span>
            </div>
            <nb-progress-bar [value]="utilitiesService.calculatePercentage(
              item.candidateFlow?.weightScore?.workExperience?.accumulativeScore,
              item.candidateFlow?.weightScore?.workExperience?.total)" status="primary" size="tiny">
            </nb-progress-bar>
          </div>
          <div class="m-b-10">
            <div class="label">Education
              <span class="pull-right">
                {{ item.candidateFlow?.weightScore?.education?.accumulativeScore || 0 }}/{{ item.candidateFlow?.weightScore?.education?.total || 0 }}
              </span>
            </div>
            <nb-progress-bar [value]="utilitiesService.calculatePercentage(
              item.candidateFlow?.weightScore?.education?.accumulativeScore,
              item.candidateFlow?.weightScore?.education?.total)" status="info" size="tiny">
            </nb-progress-bar>
          </div>
          <div class="m-b-10">
            <div class="label">Hard Skill
              <span class="pull-right">
                {{ item.candidateFlow?.weightScore?.hardSkill?.accumulativeScore || 0 }}/{{ item.candidateFlow?.weightScore?.hardSkill?.total || 0 }}
              </span>
            </div>
            <nb-progress-bar [value]="utilitiesService.calculatePercentage(
              item.candidateFlow?.weightScore?.hardSkill?.accumulativeScore,
              item.candidateFlow?.weightScore?.hardSkill?.total)" status="success" size="tiny">
            </nb-progress-bar>
          </div>
          <div class="m-b-10">
            <div class="label">Soft Skill
              <span class="pull-right">
                {{ item.candidateFlow?.weightScore?.softSkill?.accumulativeScore || 0 }}/{{ item.candidateFlow?.weightScore?.softSkill?.total || 0 }}
              </span>
            </div>
            <nb-progress-bar [value]="utilitiesService.calculatePercentage(
              item.candidateFlow?.weightScore?.softSkill?.accumulativeScore,
              item.candidateFlow?.weightScore?.softSkill?.total)" status="warning" size="tiny">
            </nb-progress-bar>
          </div>
          <div class="m-b-10">
            <div class="label">Certificate
              <span class="pull-right">
                {{ item.candidateFlow?.weightScore?.certificate?.accumulativeScore || 0 }}/{{ item.candidateFlow?.weightScore?.certificate?.total || 0 }}
              </span>
            </div>
            <nb-progress-bar [value]="utilitiesService.calculatePercentage(
              item.candidateFlow?.weightScore?.certificate?.accumulativeScore,
              item.candidateFlow?.weightScore?.certificate?.total)" status="danger" size="tiny">
            </nb-progress-bar>
          </div>
        </div>
      </div>
    </div>

    <!-- Personal Details -->
    <div class="row">
      <div class="col-md-12">
        <label class="label topic">Personal Details</label>
      </div>
      <div class="col-md-6">
        <div class="m-l-15">
          <div class="text-group">
            <label class="label">Name</label>
            <span>{{ utilitiesService.setFullname(item) || '-' }}</span>
          </div>
          <div class="text-group">
            <label class="label">Birthday</label>
            <span>{{ utilitiesService.convertDate(item.birth) || '-' }}</span>
          </div>
          <div class="text-group">
            <label class="label">Age</label>
            <span>{{ utilitiesService.calculateAgeFromBirthdate(item.birth) || '-' }}</span>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="m-l-15">
          <div class="text-group">
            <label class="label">Phone</label>
            <span>{{ item.phone || '-' }}</span>
          </div>
          <div class="text-group">
            <label class="label">Email</label>
            <span>{{ item.email || '-' }}</span>
          </div>
          <div class="text-group">
            <label class="label">Address</label>
            <span>{{ item.address || '-' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Work Experience -->
    <div class="row">
      <div class="col-md-12">
        <label class="label topic">Work Experience</label>
        <div class="m-l-15">
          <div class="text-group">
            <label class="label">Duration</label>
            <span>{{ 
              utilitiesService.convertMonthToYearText(item.workExperience?.totalExpMonth) || 
              utilitiesService.convertMonthToYearText(item.workExperience?.totalExMonth) || '-' }}
            </span>
          </div>
          <label *ngIf="item.workExperience?.work.length" class="label">Detail :</label>
          <div class="m-l-15">
            <div *ngFor="let exp of item.workExperience?.work">
              <span>• {{ utilitiesService.convertWorkExpToText(exp) }} </span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-12">
        <label class="label topic">Education</label>
        <div class="m-l-15">
          <div *ngFor="let education of item.education">
            <span>• {{ utilitiesService.convertEducationToText(education) }} </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Hard Skills -->
    <label class="label topic">Hard Skills</label>
    <div class="m-l-15">
      <span>• {{ utilitiesService.convertStringArrayToLongText(item.hardSkill) }}</span>
    </div>

    <!-- Soft Skills -->
    <label class="label topic">Soft Skills</label>
    <div class="m-l-15">
      <span>• {{ utilitiesService.convertStringArrayToLongText(item.softSkill) }}</span>
    </div>

    <!-- Certificate -->
    <label class="label topic">Certificate</label>
    <div class="m-l-15">
      <span>• {{ utilitiesService.convertStringArrayToLongText(item.certificate) }}</span>
    </div>

  </nb-card-body>

  <nb-card-footer>
    <button style="float: left;" nbButton status="success" (click)="checkCV(item._id)">Original
      CV</button>
    <span *ngFor="let button of steps">
      <span *ngIf="button.editable && button.refStage._id === item.candidateFlow?.refStage?._id">
        <button nbButton status="info" nbTooltip="Comment" (click)="openPopupComment(item)">
          <nb-icon icon="message-circle" style="margin-right: 0;"></nb-icon>
          <nb-badge *ngIf="item.candidateFlow?.comments.length" [text]="item.candidateFlow?.comments.length"
            status="danger" position="top right">
          </nb-badge>
        </button>
        <button nbButton status="success" [nbTooltip]="button.button" (click)="approve(item, button)">
          <nb-icon icon="checkmark-circle-2"></nb-icon>
        </button>
        <button nbButton status="danger" nbTooltip="Reject" (click)="reject(item)">
          <nb-icon icon="close-circle"></nb-icon>
        </button>
      </span>
    </span>
  </nb-card-footer>

</nb-card>