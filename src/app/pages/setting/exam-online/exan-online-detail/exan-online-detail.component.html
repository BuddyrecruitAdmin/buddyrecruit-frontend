<nb-card *ngIf="loading" [nbSpinner]="loading" nbSpinnerStatus="success" nbSpinnerSize="large"
    nbSpinnerMessage="Loading...">
    <nb-card-body></nb-card-body>
</nb-card>
<div *ngIf="!loading">
    <nb-card>
        <nb-card-header>
            <h5 class="text-center text-green">Exam Online</h5>
            <div class="row">
                <div class="col-md-12 col-lg-12">
                    <div class="form-control-group" [ngClass]="{ 'has-error': touchedName }">
                        <label class="text-black"><b>ชื่อแบบทดสอบ/Name Exam Form</b> <span
                                class="text-red">*</span></label>
                        <input type="text" [(ngModel)]="examName" name="name" nbInput fullWidth>
                        <small *ngIf="touchedName" class="text-red">{{ sErrorName }}</small>
                    </div>
                </div>
            </div>
        </nb-card-header>
        <nb-card-body>
            <div class="row" *ngFor="let topic of topicOption;let i = index;">
                <div class="col-md-12 col-lg-12">
                    <div class="input-group">
                        <label> {{ topic.name }}</label>
                    </div>
                    <div class="input-group-addon">
                        <nb-icon status="danger" icon="minus-square-outline" class="text-light-gray" class="link"
                            (click)="deleteTopic(topicOption,i)">
                        </nb-icon>
                    </div>
                    <div *ngIf="topic.examOptions">
                        <div *ngFor="let option of topic.examOptions;let j = index;"
                            class="input-group form-control-group">
                            <!-- <label *ngIf="option.type === 'label'">{{ option.name }}</label> -->
                            <textarea *ngIf="option.type === 'label'" type="text" [(ngModel)]="option.value" nbInput
                                fullWidth placeholder="question here"></textarea>
                            <input *ngIf="option.type === 'input'" type="text" [(ngModel)]="option.value" nbInput
                                fullWidth placeholder="answer here" disabled>
                            <textarea *ngIf="option.type === 'area'" [(ngModel)]="option.value" nbInput fullWidth
                                placeholder="answer here" disabled></textarea>
                            <!-- radio -->
                            <div *ngIf="option.type === 'radio'">
                                <br>
                                <div *ngFor="let group of option.group;let r = index"
                                    class="input-group form-control-group">
                                    <input type="text" [(ngModel)]="group.label" nbInput fullWidth
                                        placeholder="choice text here">
                                    <div class="input-group-addon">
                                        <nb-icon status="danger" icon="minus-square-outline" class="text-light-gray"
                                            class="link" (click)="deleteTopic(option.group, r)">
                                        </nb-icon>
                                    </div>
                                </div>
                                <!-- <nb-radio-group [(ngModel)]="option.value">
                                    <nb-radio *ngFor="let group of option.group;let r = index" [value]="group.value">
                                        <div class="input-group">
                                            <input type="text" [(ngModel)]="group.label" nbInput fullWidth
                                                placeholder="choice text here">
                                        </div>
                                        <div class="input-group-addon">
                                            <nb-icon status="danger" icon="minus-square-outline" class="text-light-gray"
                                                class="link" (click)="deleteTopic(option.group, r)">
                                            </nb-icon>
                                        </div>
                                    </nb-radio>
                                </nb-radio-group> -->
                                <button nbButton ghost status="danger">
                                    <nb-icon icon="plus-square-outline" class="text-light-gray" class="link"
                                        (click)="addRadio(option)">
                                    </nb-icon>
                                </button>
                            </div>
                            <div *ngIf="option.type === 'file'" style="text-align:center">
                                <img class="img-default" (click)="fileInput.click()"
                                    [src]="option.src ? option.src : 'https://image.flaticon.com/icons/png/512/55/55089.png'">
                                <br>
                                <small class="text-gray">
                                    <a style="cursor: pointer;" (click)="fileInput.click()">
                                        <span class="fa fa-images"></span>
                                        <input #fileInput type="file"
                                            (change)="fileChangeEvent(option,$event.target.files)" style="display:none;"
                                            accept="image/*" />
                                        <span class="m-l-5">Select Profile Picture</span>
                                    </a>
                                </small>
                            </div>
                            <div *ngIf="option.type === 'getFile'" style="text-align: center">
                                <small class="text-gray">
                                    <a style="cursor: pointer;" (click)="fileInput.click()">
                                        <span class="fa fa-images"></span>
                                        <input #fileInput type="file"
                                            (change)="fileChangeEvent(option,$event.target.files)" style="display:none;"
                                            accept="image/*" />
                                        <span class="m-l-5">Select Profile Picture</span>
                                    </a>
                                </small>
                            </div>
                            <div class="input-group-addon">
                                <nb-icon status="danger" icon="minus-square-outline" class="text-light-gray"
                                    class="link" (click)="deleteTopic(topicOption[i].examOptions,j)">
                                </nb-icon>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <button [nbPopover]="component" (click)="setTopic(topic)" nbPopoverPlacement="top" nbButton
                            ghost size="small">
                            <nb-icon icon="plus-square-outline" class="text-light-gray" class="link"
                                style="margin-top:10px">
                            </nb-icon>
                        </button>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <button (click)="addTopic(dialog,'topic')" nbPopoverPlacement="top" status="success" shape="round"
                        nbButton size="small">
                        <nb-icon icon="plus-outline">
                        </nb-icon>
                    </button>
                </div>
            </div>
            <div class="row btn-save">
                <div class="col-lg-12">
                    <button (click)="save()" nbPopoverPlacement="top" nbButton size="small">
                        Save
                    </button>
                </div>
            </div>
        </nb-card-body>
    </nb-card>
</div>
<!-- 4 btn label, input, checkbox, upload -->
<ng-template id="option" #tabs>
    <button (click)="addInput('input')" nbButton ghost>
        <nb-icon icon="text-outline">
        </nb-icon>
    </button>
    <button (click)="addInput('area')" nbButton ghost>
        <nb-icon icon="menu-outline"></nb-icon>
    </button>
    <button (click)="addInput('radio')" nbButton ghost>
        <nb-icon icon="checkmark-circle-2-outline"></nb-icon>
    </button>
    <button (click)="addInput('file')" nbButton ghost>
        <nb-icon icon="file-add-outline"></nb-icon>
    </button>
    <button (click)="addInput('getFile')" nbButton ghost>
        <nb-icon icon="arrow-circle-down-outline"></nb-icon>
    </button>
</ng-template>

<!-- dialogPopup -->
<ng-template #dialog let-data let-ref="dialogRef">
    <nb-card>
        <nb-card-header>
            <label class="label">Please input field name</label></nb-card-header>
        <nb-card-body>
            <div class="form-control-group">
                <input type="text" [(ngModel)]="fieldName" nbInput fullWidth placeholder="field name">
            </div>
            <div class="row">
                <div class="col-md-12 col-lg-12">

                </div>
            </div>
        </nb-card-body>
        <nb-card-footer>
            <button nbButton status="default" (click)="ref.close()">Cancel</button>
            <button nbButton status="success" (click)="createField()" [disabled]="!fieldName">OK</button>
        </nb-card-footer>
    </nb-card>
</ng-template>