<div id="app-form">

  <nb-card accent="success" [style.border-top-width.px]="10" style="margin-top: 0;">
    <nb-card-body style="padding-bottom: 0;">
      <mat-form-field appearance="outline">
        <mat-label>Application Form Name</mat-label>
        <input matInput type="text" id="firstname" name="firstname" [(ngModel)]="appForm.formName" required>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Remark</mat-label>
        <input matInput type="text" id="remark" name="remark" [(ngModel)]="appForm.formRemark">
      </mat-form-field>
    </nb-card-body>
  </nb-card>

  <!-- Personal Details -->
  <nb-card>
    <nb-card-header>
      <mat-checkbox [(ngModel)]="appForm.fieldControl.personalDetail.visible" disabled>
        Personal Details
      </mat-checkbox>
    </nb-card-header>
    <nb-card-body>
      <!-- <div class="topic">
        <mat-icon>account_circle</mat-icon>
        <p>Personal Details</p>
      </div> -->
      <div class="table-control">
        <div class="table-control-name"></div>
        <div class="table-control-actions">
          <span class="table-control-actions-item">Visible</span>
          <span class="table-control-actions-item">Required</span>
        </div>
      </div>
      <div class="table-control">
        <div class="table-control-name">Fisrt name</div>
        <div class="table-control-actions">
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.firstname.visible" (change)="changePersonalCheckbox()">
            </mat-checkbox>
          </div>
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.firstname.required"
              [disabled]="!appForm.fieldControl.firstname.visible"></mat-checkbox>
          </div>
        </div>
      </div>
      <div class="table-control">
        <div class="table-control-name">Last name</div>
        <div class="table-control-actions">
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.lastname.visible" (change)="changePersonalCheckbox()">
            </mat-checkbox>
          </div>
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.lastname.required"
              [disabled]="!appForm.fieldControl.lastname.visible"></mat-checkbox>
          </div>
        </div>
      </div>
      <div class="table-control">
        <div class="table-control-name">Birthday</div>
        <div class="table-control-actions">
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.birth.visible" (change)="changePersonalCheckbox()">
            </mat-checkbox>
          </div>
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.birth.required"
              [disabled]="!appForm.fieldControl.birth.visible"></mat-checkbox>
          </div>
        </div>
      </div>
      <div class="table-control">
        <div class="table-control-name">Age</div>
        <div class="table-control-actions">
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.age.visible" (change)="changePersonalCheckbox()">
            </mat-checkbox>
          </div>
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.age.required"
              [disabled]="!appForm.fieldControl.age.visible"></mat-checkbox>
          </div>
        </div>
      </div>
      <div class="table-control">
        <div class="table-control-name">Phone</div>
        <div class="table-control-actions">
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.phone.visible" (change)="changePersonalCheckbox()">
            </mat-checkbox>
          </div>
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.phone.required"
              [disabled]="!appForm.fieldControl.phone.visible"></mat-checkbox>
          </div>
        </div>
      </div>
      <div class="table-control">
        <div class="table-control-name">Email</div>
        <div class="table-control-actions">
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.email.visible" (change)="changePersonalCheckbox()">
            </mat-checkbox>
          </div>
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.email.required"
              [disabled]="!appForm.fieldControl.email.visible"></mat-checkbox>
          </div>
        </div>
      </div>
      <div class="table-control">
        <div class="table-control-name">Address</div>
        <div class="table-control-actions">
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.address.visible" (change)="changePersonalCheckbox()">
            </mat-checkbox>
          </div>
          <div class="table-control-actions-item">
            <mat-checkbox [(ngModel)]="appForm.fieldControl.address.required"
              [disabled]="!appForm.fieldControl.address.visible"></mat-checkbox>
          </div>
        </div>
      </div>
    </nb-card-body>
  </nb-card>

  <!-- Work Experience -->
  <nb-card>
    <nb-card-header>
      <mat-checkbox [(ngModel)]="appForm.fieldControl.workExperience.visible">
        Work Experience
        <span class="text-gray">
          ({{ appForm.fieldControl.workExperience.visible ? 'Visible' : 'Disable' }})
        </span>
      </mat-checkbox>
    </nb-card-header>
    <!-- <nb-card-body *ngIf="appForm.fieldControl.workExperience.visible">
      <div class="topic">
        <mat-icon>work</mat-icon>
        <p>Work Experience</p>
        <div>(Preview)</div>
      </div>
      <div class="box-dashed">
        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="outline">
              <mat-label>Position</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="outline">
              <mat-label>Company</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <mat-form-field appearance="outline">
              <mat-label>Employment period from</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
          <div class="col-md-2 checkbox-margin">
            <mat-checkbox disabled>Present</mat-checkbox>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline">
              <mat-label>Employment period to</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <mat-form-field appearance="outline">
              <mat-label>Roles and responsibilities</mat-label>
              <textarea matInput rows="3" disabled></textarea>
            </mat-form-field>
          </div>
        </div>
      </div>
    </nb-card-body> -->
  </nb-card>

  <!-- Education -->
  <nb-card>
    <nb-card-header>
      <mat-checkbox [(ngModel)]="appForm.fieldControl.education.visible">
        Education
        <span class="text-gray">
          ({{ appForm.fieldControl.education.visible ? 'Visible' : 'Disable' }})
        </span>
      </mat-checkbox>
    </nb-card-header>
    <!-- <nb-card-body *ngIf="appForm.fieldControl.education.visible">
      <div class="topic">
        <mat-icon>school</mat-icon>
        <p>Education</p>
        <div>(Preview)</div>
      </div>
      <div class="box-dashed">
        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="outline">
              <mat-label>Degree</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline">
              <mat-label>GPA</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <mat-form-field appearance="outline">
              <mat-label>University</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field appearance="outline">
              <mat-label>Major</mat-label>
              <input matInput type="text" disabled>
            </mat-form-field>
          </div>
        </div>
      </div>
    </nb-card-body> -->
  </nb-card>

  <!-- Hard Skills -->
  <nb-card>
    <nb-card-header>
      <mat-checkbox [(ngModel)]="appForm.fieldControl.hardSkill.visible">
        Hard Skills
        <span class="text-gray">
          ({{ appForm.fieldControl.hardSkill.visible ? 'Visible' : 'Disable' }})
        </span>
      </mat-checkbox>
    </nb-card-header>
  </nb-card>

  <!-- Soft Skills -->
  <nb-card>
    <nb-card-header>
      <mat-checkbox [(ngModel)]="appForm.fieldControl.softSkill.visible">
        Soft Skills
        <span class="text-gray">
          ({{ appForm.fieldControl.softSkill.visible ? 'Visible' : 'Disable' }})
        </span>
      </mat-checkbox>
    </nb-card-header>
  </nb-card>

  <!-- Certifications -->
  <nb-card>
    <nb-card-header>
      <mat-checkbox [(ngModel)]="appForm.fieldControl.certificate.visible">
        Certifications
        <span class="text-gray">
          ({{ appForm.fieldControl.certificate.visible ? 'Visible' : 'Disable' }})
        </span>
      </mat-checkbox>
    </nb-card-header>
  </nb-card>

  <!-- Question -->
  <nb-card *ngFor="let question of appForm.questions; let iQuestion = index;"
    accent="{{ question.required ? 'danger' : '' }}" class="card">
    <nb-card-header>
      <div class="console">
        <div class="text-left">
          <mat-form-field appearance="outline" class="fit-content">
            <mat-label>Select Question Type</mat-label>
            <mat-select [(ngModel)]="question.type">
              <mat-select-trigger>
                <mat-icon>{{ getSelectedType(question.type) }}</mat-icon>
                <span class="select-label">{{ question.type }}</span>
              </mat-select-trigger>
              <mat-option [value]="InputType.Label">
                <mat-icon>text_fields</mat-icon> {{ InputType.Label }}
              </mat-option>
              <mat-divider></mat-divider>
              <mat-option [value]="InputType.Input">
                <mat-icon>short_text</mat-icon> {{ InputType.Input }}
              </mat-option>
              <mat-option [value]="InputType.TextArea">
                <mat-icon>subject</mat-icon> {{ InputType.TextArea }}
              </mat-option>
              <mat-divider></mat-divider>
              <mat-option [value]="InputType.Radio">
                <mat-icon>radio_button_checked</mat-icon> {{ InputType.Radio }}
              </mat-option>
              <mat-option [value]="InputType.ChcekBox">
                <mat-icon>check_box</mat-icon> {{ InputType.ChcekBox }}
              </mat-option>
              <mat-option [value]="InputType.Dropdown">
                <mat-icon>arrow_drop_down_circle</mat-icon> {{ InputType.Dropdown }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="text-right">
          <button mat-icon-button type="button" [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item type="button" (click)="question.showSubTitle = !question.showSubTitle">
              <mat-icon [ngClass]="{ 'text-green' : question.showSubTitle }">
                {{ question.showSubTitle ? 'check_box' : 'check_box_outline_blank' }}
              </mat-icon>
              <span>Show Remark</span>
            </button>
            <button mat-menu-item type="button" (click)="question.required = !question.required">
              <mat-icon [ngClass]="{ 'text-green' : question.required }">
                {{ question.required ? 'check_box' : 'check_box_outline_blank' }}
              </mat-icon>
              <span>Required</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item type="button" (click)="duplicateQuestion(iQuestion)">
              <mat-icon>filter_none</mat-icon>
              <span>Duplicate</span>
            </button>
            <button mat-menu-item type="button" (click)="deleteQuestion(iQuestion)">
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </div>
      </div>
    </nb-card-header>

    <nb-card-body>
      <div class="console">
        <div class="w-100">
          <mat-form-field>
            <mat-label>Question</mat-label>
            <input matInput type="text" [(ngModel)]="question.title" required>
          </mat-form-field>
        </div>
        <button mat-icon-button type="button">
          <mat-icon class="showPhoto">photo</mat-icon>
        </button>
      </div>
      <small>
        <mat-form-field *ngIf="question.showSubTitle">
          <mat-label>Remark</mat-label>
          <input matInput type="text" [(ngModel)]="question.subTitle" required>
        </mat-form-field>
      </small>

      <div *ngIf="question.type === InputType.Input">
        <mat-form-field appearance="outline">
          <mat-label>Answer</mat-label>
          <input matInput type="text" [(ngModel)]="question.answer.input" disabled>
        </mat-form-field>
      </div>

      <div *ngIf="question.type === InputType.TextArea">
        <mat-form-field appearance="outline">
          <mat-label>Answer</mat-label>
          <textarea matInput type="text" [(ngModel)]="question.answer.textArea" rows="3" disabled></textarea>
        </mat-form-field>
      </div>

      <div *ngIf="question.type === InputType.Radio 
        || question.type === InputType.ChcekBox 
        || question.type === InputType.Dropdown">
        <div *ngFor="let option of question.answer.options; let iOption = index;" class="radio-line">
          <mat-icon>{{ getSelectedOption(question.type) }}</mat-icon>
          <mat-form-field class="w-100 m-l-10">
            <input matInput type="text" [(ngModel)]="option.label">
          </mat-form-field>
          <button mat-icon-button type="button">
            <mat-icon class="showPhoto">photo</mat-icon>
          </button>
          <button mat-icon-button type="button" (click)="deleteOption(iQuestion, iOption)"
            [disabled]="question.answer.options.length === 1">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        <div *ngIf="question.answer.hasOther" class="radio-line">
          <mat-icon>{{ getSelectedOption(question.type) }}</mat-icon>
          <mat-form-field>
            <input matInput type="text" [(ngModel)]="question.answer.otherLabel" disabled>
          </mat-form-field>
          <button mat-icon-button type="button" (click)="question.answer.hasOther = false">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        <div class="radio-line-add">
          <mat-icon class="text-light-gray m-r-10">{{ getSelectedOption(question.type) }}</mat-icon>
          <span class="link" (click)="addOption(iQuestion)">Add Option</span>
          <span *ngIf="!question.answer.hasOther" class="m-l-10 m-r-10">|</span>
          <span *ngIf="!question.answer.hasOther" class="link" (click)="question.answer.hasOther = true">Add
            Other</span>
        </div>
      </div>

    </nb-card-body>
  </nb-card>

  <!-- Add Question -->
  <nb-card class="link" (click)="addQuestion()">
    <nb-card-body>
      <div class="topic" style="margin-bottom: 0;">
        <mat-icon>add_circle_outline</mat-icon>
        <p>Add Other Form</p>
      </div>
    </nb-card-body>
  </nb-card>

  <div class="footer">
    <div class="text-left">
      <button mat-flat-button type="button" (click)="back()">
        <mat-icon>keyboard_backspace</mat-icon> Back
      </button>
    </div>
    <div class="text-right">
      <button nbButton type="button" status="primary" (click)="preview()">
        <nb-icon icon="eye-outline"></nb-icon> PREVIEW
      </button>
      <button nbButton type="submit" status="success" class="m-l-10" (click)="save()">
        <nb-icon icon="save-outline"></nb-icon> SAVE
      </button>
    </div>
  </div>

</div>